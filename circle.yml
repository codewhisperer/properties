machine:
  node:
    version: 0.10.22
dependencies:
  override:
    - npm install
    - npm run bundle
test:
  post:
    - sed -i -e 's/\/node_modules//' .gitignore
    - git config user.name "circleci"
    - git config user.email "michael@langmayr.net"
    - git add -A
    - git commit -m "build"
deployment:
  staging:
    branch: master
    commands:
      - "[[ ! -s \"$(git rev-parse --git-dir)/shallow\" ]] || git fetch --unshallow"
      - git push --force git@heroku.com:${CIRCLE_PROJECT_REPONAME}-app.git $CIRCLE_SHA1:refs/heads/master
